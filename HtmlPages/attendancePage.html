<!-- Generated By dataTablesGen.xlsm -->
<div class='content container-fluid'>
  <!-- 標題 -->
  <div class='crms-title row bg-white'>
    <div class='col'>
      <h3 class='page-title m-0'>
        <span class='page-title-icon bg-gradient-primary text-white'>
          <i class='fa fa-check-square-o' aria-hidden='true'></i> <!--icon 視需要修改-->
        </span>
        <span id='ml-查詢員工出勤'>查詢員工出勤</span>
      </h3>
    </div>
  </div>
  <!-- 顯示/隱藏 欄位 選擇 Modal -->
  <div class='modal' id='attendanceSelHideColumn' tabindex='-1' role='dialog' aria-labelledby='ml-選擇顯示欄位' aria-hidden='true'>
    <div class='modal-dialog' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h4 class='modal-title' id='ml-選擇顯示欄位'>Modal title</h4>
          <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
            <span aria-hidden='true'>&times;</span>
          </button>
        </div>
              
        <div style='margin-top=10px'>
          <button type='button' class='btn btn-secondary' style='margin:10px;background:#4CC3D5;border:none' onclick='attendanceDispAll()'>
            <span id='ml-全部顯示'></span>
          </button>
          <button type='button' class='btn btn-secondary' style='margin:10px;background:#6D757D;border:none' onclick='attendanceHideAll()'>
            <span id='ml-全部隱藏'></span>
          </button>
        </div>
              
        <div class='modal-body' id='attendance_modal'>
          <!--內容由下面程式 append-->
        </div>
              
        <div class='modal-footer'>
          <button type='button' class='btn btn-secondary' data-dismiss='modal'>
            <span id='ml-放棄設定'></span>
          </button>
          <button type='button' class='btn btn-primary' onclick='attendanceSetDispHide()'>
            <span id='ml-儲存設定'></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div style='margin: 10px'>
    <span style='margin-left:0px' id ='ml-開始日期'>開始日期</span>
    <input id='attendanceQueryStartDate' type='date' />
    <span style='margin-left:30px' id ='ml-結束日期'>結束日期</span>
    <input id='attendanceQueryEndDate' type='date'/>
        
    <button style='margin-left:30px' class='btn-gradient-primary font-weight-bold' onclick='attendanceCheck()' >
      <span id='ml-檢查'>檢 查</span>
    </button>
        
    <button type='button' style='float:right' class='btn-gradient-primary font-weight-bold' data-toggle='modal' data-target='#attendanceSelHideColumn'>
      <span id='ml-選擇顯示欄位'>選擇顯示欄位</span>
    </button>
        
    <button id='hidden_attendance_Col' type='button' style='display:none; float:right;color:black;background:white; margin-right:10px' class='btn-gradient-primary font-weight-bold' >
      <span id='ml-有隱藏欄位'>有隱藏欄位</span>
    </button>
  </div>

  <div class='row'>
    <div class='col-md-12'>
      <div class='card mb-0'>
        <div class='card-body'>
          <div class='table-responsive'>
            <table id='attendanceDataTable' class='table table-striped table-nowrap custom-table mb-0'>
              <thead>
                <tr>
                  <th ></th>                 
                  <th id='ml-出勤日期'>店鋪名稱</th>
                  <th id='ml-員工姓名'>店鋪名稱</th>
                  <th id='ml-紀錄方式'>紀錄方式</th>
                  <th id='ml-總出勤時間_分鐘'>店鋪名稱</th>
                  <th id='ml-總休息時間_分鐘'>店鋪名稱</th>
                  <th id='ml-總請假時間_分鐘'>店鋪名稱</th>
                  <th id='ml-出勤一'>店鋪名稱</th>
                  <th id='ml-退勤一'>店鋪名稱</th>
<!--
                  <th id='ml-出勤二'>店鋪名稱</th>
                  <th id='ml-退勤二'>店鋪名稱</th>
-->
                  <th id='ml-休息一_開始'>店鋪名稱</th>
                  <th id='ml-休息一_結束'>店鋪名稱</th>
                  <th id='ml-休息二_開始'>店鋪名稱</th>
                  <th id='ml-休息二_結束'>店鋪名稱</th>
                  <th id='ml-休息三_開始'>店鋪名稱</th>
                  <th id='ml-休息三_結束'>店鋪名稱</th>
                  <th id='ml-休息四_開始'>店鋪名稱</th>
                  <th id='ml-休息四_結束'>店鋪名稱</th>
                  <th id='ml-休息五_開始'>店鋪名稱</th>
                  <th id='ml-休息五_結束'>店鋪名稱</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!--  Modal for modification-->
  <div class='modal' id='attendanceModifyForm' tabindex='-1' >
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h4 class='modal-title' id='ml-修改'>Modal title</h4>
          <button type='button' class='close'>
            <span onclick='attendanceModifyFormHide()'>&times;</span>
          </button>
        </div>
              
        <div class='modal-body' id='attendance_modal'>
          <label id="ml-員工姓名">員工姓名</label><span id="modifyFormName" style="margin-left:50px; width:200px"></span><br>         
          <label id="ml-出勤日期">出勤日期</label><span id="modifyFormDate" style="margin-left:50px; width:200px"></span><br>
          <label id="ml-記錄方式">記錄方式</label><span id="記錄方式" style="margin-left:50px; width:200px"></span><br>
          <label id="ml-記錄號碼">記錄號碼</label><span id="記錄號碼" style="margin-left:50px; width:200px"></span><br>
          <label id="ml-總出勤時間">總出勤時間</label><input id="總出勤時間" style="margin-left:35px; width:200px"><br>
          <label id="ml-總休息時間">總休息時間</label><input id="總休息時間" style="margin-left:35px; width:200px"><br>
          <label id="ml-總請假時間">總請假時間</label><input id="總請假時間" style="margin-left:35px; width:200px"><br>
          <label id="ml-出勤一">出勤一</label><input type="time" id="checkIn1"  style="margin-left:65px; width:200px">
            <button onClick="clearDateTime('checkIn1')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>
            <br>     
          <label id="ml-退勤一">退勤一</label><input type="time" id="checkOut1" style="margin-left:65px; width:200px">
            <button onClick="clearDateTime('checkOut1')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>  
          <label id="ml-休息一_開始">休息一(開始)</label><input type="time" id="restStart1" style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restStart1')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>               
          <label id="ml-休息一_結束">休息一(結束)</label><input type="time" id="restEnd1"   style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restEnd1')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>           
          <label id="ml-休息二_開始">休息二(開始)</label><input type="time" id="restStart2" style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restStart2')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>           
          <label id="ml-休息二_結束">休息二(結束)</label><input type="time" id="restEnd2"   style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restEnd2')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>           
          <label id="ml-休息三_開始">休息三(開始)</label><input type="time" id="restStart3" style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restStart3')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>             
          <label id="ml-休息三_結束">休息三(結束)</label><input type="time" id="restEnd3"   style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restEnd3')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>           
          <label id="ml-休息四_開始">休息四(開始)</label><input type="time" id="restStart4" style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restStart4')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>              
          <label id="ml-休息四_結束">休息四(結束)</label><input type="time" id="restEnd4"   style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restEnd4')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>            
          <label id="ml-休息五_開始">休息五(開始)</label><input type="time" id="restStart5" style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restStart5')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>             
          <label id="ml-休息五_結束">休息五(結束)</label><input type="time" id="restEnd5"   style="margin-left:24px; width:200px">
            <button onClick="clearDateTime('restEnd5')" style="background-color:red; color:white; font-size:12px; height:25px; border:none; border-radius:5px">清除</button>           
            <br>                                                                         
        </div>
              
        <div class='modal-footer'>
          <button type='button' class='btn btn-secondary' onclick='attendanceModifyFormHide()'>
            <span id='ml-放棄設定'></span>
          </button>
          <button type='button' class='btn btn-primary' onclick='attendanceModifyUpdate()' style="background-color:red; color:white">
            <span id='ml-儲存設定'></span>
          </button>
        </div>
      </div>
    </div>
  </div>  
  
  
  <script>  
    function attendanceModifyFormHide(){
      $("#attendanceModifyForm").hide();
    }
    
    function attendanceSetDispHide(){
      var someColIsHidden = false;
      for (var i=0;i<attendanceCol_nums;i++){
        var col_check_id = '#attendanceCol_' + i.toString();
        attendanceDataTable.column(i).visible(($(col_check_id).prop('checked')));
        if (!($(col_check_id).prop('checked'))) someColIsHidden = true;
      }
      (someColIsHidden)? $('#hidden_attendance_Col').show():$('#hidden_attendance_Col').hide();
      $('#attendanceSelHideColumn').modal('toggle');
    }

    function attendanceDispAll(){
      for (var i=0;i<attendanceCol_nums;i++){
        var col_check_id = '#attendanceCol_' + i.toString();
        $(col_check_id).prop('checked', true);
      }
    }

    function attendanceHideAll(){
      for (var i=0;i<attendanceCol_nums;i++){
        var col_check_id = '#attendanceCol_' + i.toString();
        $(col_check_id).prop('checked', false);
      }
    }

    $('#attendanceQueryStartDate').val(today.toISOString().substr(0,10));
    $('#attendanceQueryEndDate').val(today.toISOString().substr(0,10));  
    
    var attendanceDataTable =$('#attendanceDataTable').DataTable( {
      dom: 'Bfrtip',
      buttons: [
        { 'extend': 'csv', 'text':'<span id="ml-匯出CSV">匯出 CSV</span>','className': 'btn-gradient-primary font-weight-bold' },
        { 'extend': 'excel', 'text':'<span id="ml-匯出EXCEL">匯出 EXCEL</span>','className': 'btn-gradient-primary font-weight-bold' }
      ], 
      order: [[ 1, 'asc' ], [ 6, 'asc' ]], //請自行修改
      data: attendanceResult,  
      columnDefs: [
        { targets: [0,],
          render: function (data) {
            //return  '<i class="fa fa-times" aria-hidden="true"></i>';
            return  `<button onClick="modifyAttendance('`+data+`')" class="btn-gradient-primary font-weight-bold" style="background-color:red; color:white;" id="ml-修改">修改</button>`;
          },
        },        
      ] 
    } );
    // 處理 顯示/隱藏 的 modal 裡的項目
    var attendanceCol_nums = attendanceDataTable.columns()[0].length;
    for (var i=0; i< attendanceCol_nums; i+=2 ){
      var name_0= attendanceDataTable.column(i).header().outerHTML.split('\"')[1]; 
      if ((i+1) < attendanceCol_nums) var name_1 = attendanceDataTable.column(i+1).header().outerHTML.split('\"')[1];
      var appendHTML=
      `<div class='row'>
          <div class='col'>
            <input id='attendanceCol_${i}' type='checkbox' checked=true /> 
            <span id='${name_0}'></span>
          </div>
      `;
      appendHTML+= ((i+1) >= attendanceCol_nums)?'':
      `   <div class='col'>
            <input id='attendanceCol_${i+1}' type='checkbox' checked=true /> 
            <span id='${name_1}'></span>
          </div>
      `;
        
      $('#attendance_modal').append(appendHTML);
    }
        
    $('#hidden_attendance_Col').hide();
        
    if (localStorage.getItem('lang')!=null) setLang(localStorage.getItem('lang'));
    
    $('#attendanceDataTable').width('100%');
  </script>
</div>


